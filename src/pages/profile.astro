
// ============================================
// 5. src/pages/profile.astro
// ä½¿ç”¨è€…å€‹äººè³‡æ–™é é¢
// ============================================
---
// src/pages/profile.astro
import BaseLayout from "@components/base/BaseLayout.astro";
---

<BaseLayout title="å€‹äººè³‡æ–™" description="æŸ¥çœ‹å’Œç®¡ç†æ‚¨çš„å€‹äººè³‡æ–™">
  <section class="section container">
    <div class="glass rounded-lg p-8 text-center">
      <h2 class="text-2xl font-bold mb-4">ğŸ”’ è«‹å…ˆç™»å…¥</h2>
      <p class="mb-6">éœ€è¦ç™»å…¥æ‰èƒ½æŸ¥çœ‹å€‹äººè³‡æ–™</p>
      <a href="/login" class="btn btn-primary">å‰å¾€ç™»å…¥</a>
    </div>
  </section>
</BaseLayout>

<style>
.btn {
  @apply px-4 py-2 rounded-lg font-semibold transition-colors;
}

.btn-primary {
  @apply bg-blue-500 text-white hover:bg-blue-600;
}

.btn-secondary {
  @apply bg-gray-500 text-white hover:bg-gray-600;
}

.btn-danger {
  @apply bg-red-500 text-white hover:bg-red-600;
}
</style>

<script>
  // å®¢æˆ¶ç«¯æª¢æŸ¥ç™»å…¥ç‹€æ…‹
  if (typeof window !== 'undefined') {
    const token = localStorage.getItem('auth_token');
    const userInfo = localStorage.getItem('user_info');
    
    if (token && userInfo) {
      try {
        const user = JSON.parse(userInfo);
        const container = document.querySelector('.section.container');
        
        // æ ¼å¼åŒ–æ—¥æœŸ
        const formatDate = (dateStr: string) => {
          return new Date(dateStr).toLocaleDateString('zh-TW');
        };
        
        // è§’è‰²é¡¯ç¤º
        const roleMap: Record<string, string> = {
          guest: 'è¨ªå®¢',
          user: 'æ™®é€šç”¨æˆ¶',
          premium: 'é«˜ç´šæœƒå“¡',
          admin: 'ç®¡ç†å“¡'
        };
        
        // è§’è‰²å¾½ç« é¡è‰²
        const badgeClass = (role: string) => {
          const classes: Record<string, string> = {
            premium: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200',
            admin: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',
            user: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',
            guest: 'bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200',
          };
          return classes[role] || classes.guest;
        };
        
        if (container) {
          container.innerHTML = `
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <!-- å·¦å´ï¼šå€‹äººé ­åƒå’ŒåŸºæœ¬è³‡è¨Š -->
              <div class="md:col-span-1">
                <div class="glass rounded-lg p-6 text-center sticky top-20">
                  <div class="mb-4">
                    <img 
                      src="${user.avatar || '/default-avatar.png'}" 
                      alt="${user.name}"
                      class="w-24 h-24 rounded-full mx-auto border-4 border-primary"
                    />
                  </div>
                  <h1 class="text-2xl font-bold mb-1">${user.name}</h1>
                  <p class="text-gray-600 dark:text-gray-400 mb-4">@${user.username}</p>
                  <span class="inline-block px-3 py-1 rounded-full text-sm font-semibold ${badgeClass(user.role)}">
                    ${roleMap[user.role]}
                  </span>
                  <button 
                    onclick="handleLogout()"
                    class="w-full mt-6 btn btn-danger">
                    ç™»å‡º
                  </button>
                </div>
              </div>

              <!-- å³å´ï¼šè©³ç´°è³‡è¨Š -->
              <div class="md:col-span-2 space-y-6">
                <!-- åŸºæœ¬è³‡è¨Šå¡ç‰‡ -->
                <div class="glass rounded-lg p-6">
                  <h2 class="text-xl font-bold mb-4">ğŸ“‹ åŸºæœ¬è³‡è¨Š</h2>
                  <div class="space-y-4">
                    <div class="flex justify-between py-3 border-b border-gray-200 dark:border-gray-700">
                      <span class="text-gray-600 dark:text-gray-400">é›»å­éƒµä»¶</span>
                      <span class="font-semibold">${user.email}</span>
                    </div>
                    ${user.phone ? `
                    <div class="flex justify-between py-3 border-b border-gray-200 dark:border-gray-700">
                      <span class="text-gray-600 dark:text-gray-400">é›»è©±</span>
                      <span class="font-semibold">${user.phone}</span>
                    </div>
                    ` : ''}
                    <div class="flex justify-between py-3 border-b border-gray-200 dark:border-gray-700">
                      <span class="text-gray-600 dark:text-gray-400">åŠ å…¥æ—¥æœŸ</span>
                      <span class="font-semibold">${formatDate(user.joinDate)}</span>
                    </div>
                    <div class="flex justify-between py-3">
                      <span class="text-gray-600 dark:text-gray-400">æœ€å¾Œç™»å…¥</span>
                      <span class="font-semibold">${formatDate(user.lastLogin)}</span>
                    </div>
                  </div>
                </div>

                <!-- å¸³æˆ¶æ¬Šé™ -->
                <div class="glass rounded-lg p-6">
                  <h2 class="text-xl font-bold mb-4">ğŸ” å¸³æˆ¶æ¬Šé™</h2>
                  <div class="space-y-3">
                    <div class="flex items-center gap-3 p-3 rounded-lg bg-green-100 dark:bg-green-900/30">
                      <span class="text-lg">âœ…</span>
                      <div class="flex-1">
                        <p class="font-semibold">å€‹äººè³‡æ–™ç®¡ç†</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">æŸ¥çœ‹å’Œç·¨è¼¯æ‚¨çš„å€‹äººè³‡æ–™</p>
                      </div>
                    </div>
                    <div class="flex items-center gap-3 p-3 rounded-lg ${user.role === 'premium' || user.role === 'admin' ? 'bg-green-100 dark:bg-green-900/40' : 'bg-gray-100 dark:bg-gray-800'}">
                      <span class="text-lg">${user.role === 'premium' || user.role === 'admin' ? 'âœ…' : 'ğŸ”’'}</span>
                      <div class="flex-1">
                        <p class="font-semibold">æˆ‘çš„æ”¶è—</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                          ${user.role === 'premium' || user.role === 'admin' ? 'å·²è§£é–' : 'éœ€è¦é«˜ç´šæœƒå“¡'}
                        </p>
                      </div>
                    </div>
                    <div class="flex items-center gap-3 p-3 rounded-lg ${user.role === 'premium' || user.role === 'admin' ? 'bg-green-100 dark:bg-green-900/40' : 'bg-gray-100 dark:bg-gray-800'}">
                      <span class="text-lg">${user.role === 'premium' || user.role === 'admin' ? 'âœ…' : 'ğŸ”’'}</span>
                      <div class="flex-1">
                        <p class="font-semibold">é€²åº¦è¿½è¹¤</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                          ${user.role === 'premium' || user.role === 'admin' ? 'å·²è§£é–' : 'éœ€è¦é«˜ç´šæœƒå“¡'}
                        </p>
                      </div>
                    </div>
                    <div class="flex items-center gap-3 p-3 rounded-lg ${user.role === 'admin' ? 'bg-green-100 dark:bg-green-900/40' : 'bg-gray-100 dark:bg-gray-800'}">
                      <span class="text-lg">${user.role === 'admin' ? 'âœ…' : 'ğŸ”’'}</span>
                      <div class="flex-1">
                        <p class="font-semibold">ç®¡ç†å¾Œå°</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                          ${user.role === 'admin' ? 'å·²è§£é–' : 'åƒ…é™ç®¡ç†å“¡'}
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- å€‹äººç°¡ä»‹ -->
                ${user.bio ? `
                <div class="glass rounded-lg p-6">
                  <h2 class="text-xl font-bold mb-4">ğŸ’¬ å€‹äººç°¡ä»‹</h2>
                  <p class="text-gray-700 dark:text-gray-300">
                    ${user.bio}
                  </p>
                </div>
                ` : ''}

                <!-- æ“ä½œæŒ‰éˆ• -->
                <div class="flex gap-4">
                  <button class="flex-1 btn btn-primary" onclick="alert('ç·¨è¼¯åŠŸèƒ½é–‹ç™¼ä¸­')">ç·¨è¼¯è³‡æ–™</button>
                  <button class="flex-1 btn btn-secondary" onclick="alert('ä¿®æ”¹å¯†ç¢¼åŠŸèƒ½é–‹ç™¼ä¸­')">ä¿®æ”¹å¯†ç¢¼</button>
                </div>
              </div>
            </div>
          `;
        }
      } catch (error) {
        console.error('Error parsing user info:', error);
      }
    }
  }
  
  // ç™»å‡ºå‡½æ•¸
  function handleLogout() {
    localStorage.removeItem('auth_token');
    localStorage.removeItem('user_info');
    window.location.href = '/';
  }
</script>
