// src/components/user/MyCollections.astro
---
interface Collection {
  id: number;
  title: string;
  description: string;
  items: number;
}

interface Props {
  isLoggedIn?: boolean;
  hasPremium?: boolean;
  collections?: Collection[];
}

const { 
  isLoggedIn = false, 
  hasPremium = false,
  collections = [
    { id: 1, title: 'æœ€æ„›æ–‡ç« ', description: 'æˆ‘çš„ç²¾é¸æ–‡ç« ', items: 5 },
    { id: 2, title: 'å­¸ç¿’è³‡æº', description: 'ç¨‹å¼è¨­è¨ˆå­¸ç¿’è³‡æ–™', items: 12 },
  ]
} = Astro.props;
---

<div class="collections-container section container">
  {!isLoggedIn && (
    <div class="access-denied glass rounded-lg p-8 text-center">
      <h2 class="text-2xl font-bold mb-4">ğŸ“š æˆ‘çš„æ”¶è—</h2>
      <p class="mb-6">æ­¤åŠŸèƒ½åƒ…é™å·²ç™»å…¥ç”¨æˆ¶ä½¿ç”¨</p>
      <a href="/login" class="btn btn-primary">å‰å¾€ç™»å…¥</a>
    </div>
  )}

  {isLoggedIn && !hasPremium && (
    <div class="premium-required glass rounded-lg p-8 text-center">
      <h2 class="text-2xl font-bold mb-4">ğŸ”’ é«˜ç´šåŠŸèƒ½</h2>
      <p class="mb-6">æˆ‘çš„æ”¶è—åŠŸèƒ½éœ€è¦é«˜ç´šæœƒå“¡æ¬Šé™</p>
      
      <div class="features bg-bg-t p-4 rounded my-6 text-left">
        <h3 class="font-bold mb-3">é«˜ç´šæœƒå“¡å¯äº«å—ï¼š</h3>
        <ul class="list-none space-y-2">
          <li>âœ“ ä¿å­˜ç„¡é™å€‹äººæœ€æ„›æ–‡ç« </li>
          <li>âœ“ å»ºç«‹å¤šå€‹æ”¶è—æ¸…å–®</li>
          <li>âœ“ åˆ†äº«æ”¶è—çµ¦æœ‹å‹</li>
          <li>âœ“ é›¢ç·šæŸ¥çœ‹ä¿å­˜å…§å®¹</li>
        </ul>
      </div>
      
      <button onclick="upgradeToPremium()" class="btn btn-upgrade">å‡ç´šåˆ°é«˜ç´šæœƒå“¡</button>
    </div>
  )}

  {isLoggedIn && hasPremium && (
    <div class="collections-content">
      <h2 class="text-2xl font-bold mb-6">ğŸ“š æˆ‘çš„æ”¶è—</h2>
      
      <button 
        onclick="openAddDialog()" 
        class="btn btn-primary mb-6"
      >
        + æ–°å¢æ”¶è—
      </button>

      {collections.length > 0 ? (
        <div class="collections-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {collections.map((collection) => (
            <div class="collection-card glass rounded-lg p-4 hover:shadow-lg transition-shadow">
              <h3 class="font-bold mb-2">{collection.title}</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">{collection.description}</p>
              <div class="flex justify-between items-center">
                <span class="text-xs text-gray-500">{collection.items} é …ç›®</span>
                <div class="flex gap-2">
                  <button 
                    onclick={`editCollection(${collection.id})`}
                    class="btn-small"
                  >
                    ç·¨è¼¯
                  </button>
                  <button 
                    onclick={`deleteCollection(${collection.id})`}
                    class="btn-small btn-danger"
                  >
                    åˆªé™¤
                  </button>
                </div>
              </div>
            </div>
          ))}
        </div>
      ) : (
        <div class="empty-state glass rounded-lg p-8 text-center text-gray-500">
          <p>æ‚¨é‚„æ²’æœ‰ä»»ä½•æ”¶è—ã€‚é–‹å§‹å»ºç«‹æ‚¨çš„ç¬¬ä¸€å€‹æ”¶è—å§ï¼</p>
        </div>
      )}

      {/* æ–°å¢æ”¶è—å°è©±æ¡† */}
      <div id="addDialog" class="hidden modal-overlay" onclick="closeAddDialog()">
        <div class="modal-content" onclick="event.stopPropagation()">
          <h3 class="text-lg font-bold mb-4">æ–°å¢æ”¶è—</h3>
          <input 
            id="collectionTitle"
            placeholder="æ”¶è—æ¨™é¡Œ"
            class="input-field w-full px-3 py-2 border rounded-lg dark:bg-darkmode-bg-t mb-3"
          />
          <textarea 
            id="collectionDesc"
            placeholder="æ”¶è—æè¿°"
            class="input-field w-full px-3 py-2 border rounded-lg dark:bg-darkmode-bg-t mb-4"
            rows="3"
          ></textarea>
          <div class="flex gap-2">
            <button onclick="addCollection()" class="btn btn-primary">æ–°å¢</button>
            <button onclick="closeAddDialog()" class="btn btn-secondary">å–æ¶ˆ</button>
          </div>
        </div>
      </div>
    </div>
  )}
</div>

<script>
const openAddDialog = () => {
  document.getElementById('addDialog')?.classList.remove('hidden');
};

const closeAddDialog = () => {
  document.getElementById('addDialog')?.classList.add('hidden');
};

const addCollection = () => {
  const title = document.getElementById('collectionTitle')?.value;
  const desc = document.getElementById('collectionDesc')?.value;
  
  if (title?.trim()) {
    // é€™è£¡éœ€è¦èª¿ç”¨ API ä¿å­˜åˆ°ä¼ºæœå™¨
    console.log('æ–°å¢æ”¶è—:', { title, desc });
    closeAddDialog();
    alert('æ”¶è—å·²æ–°å¢ï¼');
  }
};

const editCollection = (id) => {
  console.log('ç·¨è¼¯æ”¶è—:', id);
  alert('ç·¨è¼¯åŠŸèƒ½å°šæœªå¯¦ç¾');
};

const deleteCollection = (id) => {
  if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤æ”¶è—å—ï¼Ÿ')) {
    console.log('åˆªé™¤æ”¶è—:', id);
    alert('æ”¶è—å·²åˆªé™¤ï¼');
  }
};

const upgradeToPremium = () => {
  alert('å‡ç´šåŠŸèƒ½å°šæœªå¯¦ç¾ï¼Œè«‹è¯çµ¡ç®¡ç†å“¡');
};
</script>

<style>
.collections-container {
  @apply section container;
}

.access-denied, .premium-required {
  @apply glass rounded-lg p-8 text-center;
}

.collections-grid {
  @apply grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4;
}

.collection-card {
  @apply hover:shadow-lg transition-shadow;
}

.empty-state {
  @apply glass rounded-lg p-8 text-center text-gray-500;
}

.modal-overlay {
  @apply fixed inset-0 bg-black/50 flex items-center justify-center z-50;
}

.modal-content {
  @apply glass rounded-lg p-6 max-w-md w-full mx-4 space-y-4;
}

.input-field {
  @apply w-full px-3 py-2 border rounded-lg dark:bg-darkmode-bg-t;
}

.btn-small {
  @apply px-2 py-1 text-sm rounded bg-blue-500 text-white hover:bg-blue-600;
}

.btn-small.btn-danger {
  @apply bg-red-500 hover:bg-red-600;
}

.btn {
  @apply px-4 py-2 rounded-lg font-semibold transition-colors;
}

.btn-primary {
  @apply bg-blue-500 text-white hover:bg-blue-600;
}

.btn-secondary {
  @apply bg-gray-500 text-white hover:bg-gray-600;
}

.btn-upgrade {
  @apply bg-yellow-500 text-white hover:bg-yellow-600;
}
</style>

---

// src/components/user/ProgressTracker.astro
---
interface Course {
  id: number;
  name: string;
  progress: number;
  completed: number;
  total: number;
}

interface Activity {
  id: number;
  icon: string;
  title: string;
  date: string;
}

interface Props {
  isLoggedIn?: boolean;
  hasPremium?: boolean;
}

const { 
  isLoggedIn = false, 
  hasPremium = false,
} = Astro.props;

const courses: Course[] = [
  { id: 1, name: 'Java åŸºç¤', progress: 85, completed: 17, total: 20 },
  { id: 2, name: 'Spring Boot é€²éš', progress: 60, completed: 9, total: 15 },
  { id: 3, name: 'React å¯¦æˆ°', progress: 40, completed: 6, total: 15 },
];

const recentActivities: Activity[] = [
  { id: 1, icon: 'âœ…', title: 'å®Œæˆèª²ç¨‹: Spring Boot åŸºç¤', date: 'ä»Šå¤© 14:30' },
  { id: 2, icon: 'ğŸ¯', title: 'é”æˆ 7 å¤©é€£çºŒç°½åˆ°', date: 'æ˜¨å¤© 09:00' },
  { id: 3, icon: 'ğŸ“', title: 'å®Œæˆæ¸¬é©—: Java é€²éšèªæ³•', date: '3 å¤©å‰' },
  { id: 4, icon: 'ğŸ†', title: 'ç²å¾—æˆå°±: å¿«é€Ÿå­¸ç¿’è€…', date: 'ä¸€é€±å‰' },
];
---

<div class="tracker-container section container">
  {!isLoggedIn && (
    <div class="access-denied glass rounded-lg p-8 text-center">
      <h2 class="text-2xl font-bold mb-4">ğŸ“Š é€²åº¦è¿½è¹¤</h2>
      <p class="mb-6">æ­¤åŠŸèƒ½åƒ…é™å·²ç™»å…¥ç”¨æˆ¶ä½¿ç”¨</p>
      <a href="/login" class="btn btn-primary">å‰å¾€ç™»å…¥</a>
    </div>
  )}

  {isLoggedIn && !hasPremium && (
    <div class="premium-required glass rounded-lg p-8 text-center">
      <h2 class="text-2xl font-bold mb-4">ğŸ”’ é«˜ç´šåŠŸèƒ½</h2>
      <p class="mb-6">é€²åº¦è¿½è¹¤åŠŸèƒ½éœ€è¦é«˜ç´šæœƒå“¡æ¬Šé™</p>
      
      <div class="features bg-bg-t p-4 rounded my-6 text-left">
        <h3 class="font-bold mb-3">é«˜ç´šæœƒå“¡å¯äº«å—ï¼š</h3>
        <ul class="list-none space-y-2">
          <li>âœ“ è©³ç´°çš„å­¸ç¿’é€²åº¦åˆ†æ</li>
          <li>âœ“ å®Œæˆåº¦çµ±è¨ˆåœ–è¡¨</li>
          <li>âœ“ å€‹äººåŒ–å»ºè­°</li>
          <li>âœ“ å°å‡ºé€²åº¦å ±å‘Š</li>
        </ul>
      </div>
      
      <button onclick="upgradeToPremium()" class="btn btn-upgrade">å‡ç´šåˆ°é«˜ç´šæœƒå“¡</button>
    </div>
  )}

  {isLoggedIn && hasPremium && (
    <div class="tracker-content">
      <h2 class="text-2xl font-bold mb-6">ğŸ“Š é€²åº¦è¿½è¹¤</h2>
      
      <div class="stats-grid grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div class="stat-box glass rounded-lg p-4">
          <h3 class="font-semibold mb-3">ç¸½å®Œæˆåº¦</h3>
          <div class="progress-bar w-full h-2 bg-gray-300 rounded-full overflow-hidden mb-2">
            <div class="progress h-full bg-gradient-to-r from-blue-500 to-purple-500" style="width: 65%"></div>
          </div>
          <p class="text-lg font-bold">65%</p>
        </div>

        <div class="stat-box glass rounded-lg p-4">
          <h3 class="font-semibold mb-2">æœ¬æœˆå­¸ç¿’æ™‚æ•¸</h3>
          <p class="text-3xl font-bold">28h</p>
          <p class="text-sm text-gray-500">ç›®æ¨™: 40h</p>
        </div>

        <div class="stat-box glass rounded-lg p-4">
          <h3 class="font-semibold mb-2">é€£çºŒç°½åˆ°å¤©æ•¸</h3>
          <p class="text-3xl font-bold">12</p>
          <p class="text-sm text-gray-500">ğŸ”¥ ä¿æŒåŠ æ²¹!</p>
        </div>
      </div>

      {/* èª²ç¨‹é€²åº¦ */}
      <section class="courses-section glass rounded-lg p-6 mb-6">
        <h3 class="text-xl font-bold mb-4">èª²ç¨‹é€²åº¦</h3>
        <div class="space-y-4">
          {courses.map((course) => (
            <div class="course-item">
              <div class="flex justify-between mb-2">
                <span class="font-semibold">{course.name}</span>
                <span class="text-sm">{course.progress}%</span>
              </div>
              <div class="progress-bar w-full h-2 bg-gray-300 rounded-full overflow-hidden mb-1">
                <div 
                  class="progress h-full bg-gradient-to-r from-blue-500 to-purple-500" 
                  style={`width: ${course.progress}%`}
                ></div>
              </div>
              <p class="text-xs text-gray-500">{course.completed} / {course.total} å®Œæˆ</p>
            </div>
          ))}
        </div>
      </section>

      {/* æœ€è¿‘æ´»å‹• */}
      <section class="activity-section glass rounded-lg p-6">
        <h3 class="text-xl font-bold mb-4">æœ€è¿‘æ´»å‹•</h3>
        <div class="space-y-3">
          {recentActivities.map((activity) => (
            <div class="activity-item flex items-start gap-3 p-3 rounded bg-gray-50 dark:bg-gray-800">
              <span class="icon text-xl">{activity.icon}</span>
              <div>
                <p class="font-semibold">{activity.title}</p>
                <p class="text-sm text-gray-500">{activity.date}</p>
              </div>
            </div>
          ))}
        </div>
      </section>
    </div>
  )}
</div>

<script>
const upgradeToPremium = () => {
  alert('å‡ç´šåŠŸèƒ½å°šæœªå¯¦ç¾ï¼Œè«‹è¯çµ¡ç®¡ç†å“¡');
};
</script>

<style>
.tracker-container {
  @apply section container;
}

.access-denied, .premium-required {
  @apply glass rounded-lg p-8 text-center;
}

.stats-grid {
  @apply grid grid-cols-1 md:grid-cols-3 gap-4;
}

.stat-box {
  @apply shadow;
}

.progress-bar {
  @apply w-full h-2 bg-gray-300 rounded-full overflow-hidden;
}

.progress {
  @apply h-full transition-all;
}

.course-item {
  @apply p-3 border rounded-lg border-gray-200 dark:border-gray-700;
}

.activity-item {
  @apply flex items-start gap-3 p-3 rounded bg-gray-50 dark:bg-gray-800;
}

.btn {
  @apply px-4 py-2 rounded-lg font-semibold transition-colors;
}

.btn-primary {
  @apply bg-blue-500 text-white hover:bg-blue-600;
}

.btn-upgrade {
  @apply bg-yellow-500 text-white hover:bg-yellow-600;
}
</style>
